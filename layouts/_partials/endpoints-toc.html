{{/* Minimal list of API endpoints for the current page. */}}
{{ $raw := .Scratch.Get "api_endpoints" }}
{{/* Normalize to a slice */}}
{{ $endpoints := slice }}
{{ if reflect.IsSlice $raw }}
  {{ $endpoints = $raw }}
{{ else if reflect.IsMap $raw }}
  {{ range $raw }}
    {{ $endpoints = append $endpoints . }}
  {{ end }}
{{ end }}
{{ if gt (len $endpoints) 0 }}
  <div class="endpoints-toc mb-4">
    <details>
      <summary>List of Endpoints</summary>
      {{/* Sort by module to group visually */}}
      {{ $sorted := sort $endpoints "module" }}
      {{ $current := "" }}
      {{ $seen := newScratch }}
      {{ range $sorted }}
        {{ $mod := .module }}
        {{ if not $mod }}{{ $mod = "Required" }}{{ end }}
        {{ if ne $mod $current }}
          {{ if $current }}</ul></div>{{ end }}
          <div class="endpoint-module">
            <div class="endpoint-module-title">{{ $mod }}</div>
            <ul class="endpoint-list">
          {{ $current = $mod }}
        {{ end }}
        {{ $key := printf "%s|%s" .method .anchor }}
        {{ if not ($seen.Get $key) }}
          {{ $seen.Set $key true }}
          <li>
            <a href="#{{ .anchor }}">
              <span class="http-api-method">{{ .method }}</span>
              <span class="endpoint-path">{{ .endpoint }}</span>
              {{ if .deprecated }}<span class="endpoint-deprecated">(deprecated)</span>{{ end }}
            </a>
          </li>
        {{ end }}
      {{ end }}
      {{ if $current }}</ul></div>{{ end }}
    </details>
  </div>
{{ end }}
